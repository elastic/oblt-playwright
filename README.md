# oblt-playwright

A test framework for assessing the search performance of Elastic Observability solution across various deployment types from the end-user perspective, supporting the last released version.

## üì¶ Getting Started

### Prerequisites

#### Datasets

Test suites ([APM](https://github.com/elastic/oblt-playwright/blob/main/docs/test_apm.md), [Infrastructure](https://github.com/elastic/oblt-playwright/blob/main/docs/test_infra.md), [Logs](https://github.com/elastic/oblt-playwright/blob/main/docs/test_logs.md)) require a deployment/project to ingest scenario-specific data, examine [required datasets](https://github.com/elastic/oblt-playwright/blob/main/docs/data_mapping.md) accordingly.

Note: APM scenarios are strictly bound to data generated by [apmsoak](https://github.com/elastic/apm-perf/tree/main/cmd/apmsoak).

#### Background tasks

To assess the performance impact of alerting rules, you can create them before running tests. Use the following command to establish a set of rules that are checked every minute:

```bash
npx playwright test alerting_rules.api.spec.ts --project api
```

This will create alerting rules for the following rule types:

- `.es-query`
- `apm.anomaly`
- `apm.error_rate`
- `apm.transaction_duration`
- `apm.transaction_error_rate`
- `metrics.alert.inventory.threshold`

## ü§ñ CI

### üîí Environmental variables 

#### GitHub Actions Secrets:

```typescript
API_KEY_SERVERLESS =
API_KEY_STATEFUL =
ELASTICSEARCH_HOST_SERVERLESS = // No trailing slash
ELASTICSEARCH_HOST_STATEFUL = // No trailing slash
KIBANA_HOST_SERVERLESS = 
KIBANA_HOST_STATEFUL = 
KIBANA_PASSWORD_SERVERLESS = 
KIBANA_PASSWORD_STATEFUL = 
KIBANA_USERNAME_SERVERLESS = 
KIBANA_USERNAME_STATEFUL = 
REPORT_CLUSTER_ES = // No trailing slash
REPORT_CLUSTER_API_KEY = 'ApiKey ...'
```

#### GitHub Actions Variables:

```typescript
REPORT_CLUSTER_INDEX = 
START_DATE = '2025-06-24T00:00:00.000Z' // Set when the absolute time range is used
END_DATE = '2025-06-25T00:00:00.000Z' // Set when the absolute time range is used
// Predefined variables:
TIME_UNIT_HOURS
TIME_UNIT_DAYS
TIME_VALUE_1
TIME_VALUE_3
TIME_VALUE_7
TIME_VALUE_14
TIME_VALUE_29
```

### üöÄ Workflows

Currently configured workflows (see [ECH](https://github.com/elastic/oblt-playwright/blob/main/.github/workflows/ech.yml) | [Serverless ](https://github.com/elastic/oblt-playwright/blob/main/.github/workflows/serverless.yml)) execute each of the test suites ([APM](https://github.com/elastic/oblt-playwright/blob/main/docs/test_apm.md), [Dataset Quality](https://github.com/elastic/oblt-playwright/blob/main/docs/test_datasets.md), [Infrastructure](https://github.com/elastic/oblt-playwright/blob/main/docs/test_infra.md), [Logs](https://github.com/elastic/oblt-playwright/blob/main/docs/test_logs.md)) on an hourly basis with 15 minute intervals between them.
- APM test suite executes at the top of each hour.
- Dataset Quality executes 15 minutes past the hour.
- Infrastructure test suite executes 30 minutes past the hour.
- Logs test suite executes 45 minutes past the hour.

Tests are executed sequentially, with only one Kibana user at a given time.

#### To use the absolute time range:

1. Set `START_DATE` and `END_DATE` GitHub Actions variables.
2. Set `ABSOLUTE_TIME_RANGE` workflow job environmental variables  to `true`.


### üìä Test reports

A custom reporter generates JSON files and transmits them to a remote Elasticsearch reporting cluster (specify Elasticsearch endpoint as `REPORT_CLUSTER_ES` and set `REPORT_CLUSTER_API_KEY`). Make sure to create an index first and pass its name into `REPORT_CLUSTER_INDEX` variable. In a newly created index, match `startTime` field to `Date` type.

## üíª Local usage

### üõ†Ô∏è Installation

Make sure you have [Node.js](https://nodejs.org/en/download) installed.

1. Clone the repository.
```bash
git clone https://github.com/elastic/oblt-playwright.git
```
2. Install dependencies:
```bash
npm install
```
3. Install Chromium:
```bash
npx playwright install chromium
```

### ‚öôÔ∏è Setup 

#### üîí Environmental variables

```typescript
KIBANA_HOST = 
ELASTICSEARCH_HOST = // No trailing slash
KIBANA_USERNAME = 
KIBANA_PASSWORD = 
TIME_UNIT = 'Minutes'
TIME_VALUE = 15
ABSOLUTE_TIME_RANGE = false // Set 'true' to use the absolute time range
START_DATE = '2025-06-24T00:00:00.000Z' // Set when the absolute time range is used
END_DATE = '2025-06-25T00:00:00.000Z' // Set when the absolute time range is used
API_KEY =
```

#### üìÇ Test report location

Create `playwright-report` directory in the root.

### ‚ñ∂Ô∏è Running tests

By default, tests run in headless mode. To launch browsers in headed mode, use the `--headed` flag.
It is recommended to run tests during ongoing data collection.

#### Run all suites

```bash
npx playwright test --project kibana --headed
```

#### Run a specific suite

```bash
npx playwright test apm.kibana.spec.ts --project kibana --headed
```

#### Run a specific test

```bash
npx playwright test -g "APM - Services" --project kibana --headed
```

## üìö Additional Resources

- [Test suites and required datasets](https://github.com/elastic/oblt-playwright/blob/main/docs/data_mapping.md)
- Step definitions: [APM](https://github.com/elastic/oblt-playwright/blob/main/docs/test_apm.md) | [Infrastructure](https://github.com/elastic/oblt-playwright/blob/main/docs/test_infra.md) | [Logs](https://github.com/elastic/oblt-playwright/blob/main/docs/test_logs.md)
